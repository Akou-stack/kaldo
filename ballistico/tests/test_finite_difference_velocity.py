import numpy as np
from ase.build import bulk
from ase.calculators.emt import EMT
from ballistico.finitedifference import FiniteDifference
from ballistico.phonons import Phonons
import pytest
from tempfile import TemporaryDirectory

vx = np.array([[-9.025609311813682,-13.612479934346673,-27.283651574633886],
[-7.202364810141338,-1.0416722046628968,-11.710093458635212],
[7.202364731398464,1.0416722834057732,11.710093458635205],
[9.025610257874296,13.612478988286053,27.283651574633886],
[-16.74564748827444,-5.892441840715238,-27.28365155062675],
[-27.19220419070746,-27.18972597822733,-41.65667165246768],
[-16.600224392217644,-30.335621809186065,-17.143046898647434],
[-4.296120515069043,-29.457332836277953,11.262646373759331],
[2.1965427113456333e-08,-1.8720116923280655e-08,1.8059138937553546e-08],
[-5.829394591197398,-2.4146424706236704,-11.71009345564121],
[-16.600224372903792,-30.335621785885333,-17.14304691044728],
[-10.0305178097481,-10.03038621896678,-20.060462469575597],
[9.941502012031121e-09,9.423147700994779e-09,-1.0469938887576195e-09],
[4.296120495671876,29.45733285510733,-11.2626463780973],
[5.8293989824228785,2.4146380793981934,11.710093455641207],
[-4.296120495671871,-29.457332855107335,11.262646378097312],
[-9.941518265635624e-09,-9.423183530950142e-09,1.0469788341248538e-09],
[10.030517809780836,10.030386218934034,20.060462469575587],
[16.600224372903778,30.33562178588533,17.143046910447254],
[16.745645929873596,5.892443399116074,27.283651550626747],
[-2.196542150184232e-08,1.8720079050401256e-08,-1.8059099961327684e-08],
[4.296120515069048,29.457332836277953,-11.262646373759326],
[16.60022439221762,30.33562180918605,17.143046898647402],
[27.19220419051293,27.189725978421865,41.656671652467686],
[2.777945652142093,19.84132581945163,27.279534793226397],
[0.0009878198223970834,-0.0009878353960163793,-1.2935945344662112e-09],
[4.484041771240113,1.9007316107073722,-12.175579194318548],
[10.337765861488664,11.370093759594276,0.7015215392686299],
[13.702130240410781,20.890083472499143,18.43059010112468],
[0.0008457967073442528,-0.0008458071728713399,6.586001395555329e-09],
[-4.112640540936157,-18.506630874789114,-27.279534816118552],
[-13.702130270581765,-20.890083482979954,-18.43059009905323],
[-10.337765869369237,-11.370093757181973,-0.7015215566792377],
[-4.484041811347759,-1.9007315791682144,12.175579203978817],
[4.484041761305489,1.900731619772063,-12.175579194728758],
[-13.70213025061343,-20.89008348343349,-18.430590090625117],
[-16.60010018866051,-30.33620151974958,-17.14371323546528],
[-17.594197377238956,-8.969780227425543,-4.529829319813565],
[-1.3488523713438728e-08,-2.4462428844640936e-09,1.1307915154356353e-08],
[10.337765846143999,11.370093769273216,0.7015215498107504],
[-10.337765843779843,-11.370093776177537,-0.701521559004023],
[-17.594197411881765,-8.969780218179222,-4.529829307496066],
[-3.0533688688057116e-09,6.311067263093695e-10,-5.260438114363672e-10],
[17.59419740105692,8.969780227959717,4.529829299395205],
[13.70213026052461,20.890083487438663,18.430590113612574],
[-4.484041725669713,-1.9007316508812462,12.175579202433742],
[1.3433560022139496e-08,8.062852179242726e-09,2.2432177501898046e-09],
[17.594197406470233,8.969780220183715,4.529829311784054],
[16.600100186311515,30.336201496735196,17.143713252143776],
[1.76767034937396,6.4732380137013665,11.714006199757305],
[-4.484165975049469,-1.9001519254467756,12.176245516485979],
[-0.00014028011463496955,0.00014029892509754551,1.4166173118625164e-08],
[7.196366808994837,-12.257002032912954,8.116857720574531],
[10.337431417117568,11.370319211360377,0.7030138397539865],
[-4.484165930200154,-1.9001519958536146,12.17624551735518],
[-1.2878966785634896e-09,1.2680547702325115e-08,-6.781932269306642e-09],
[4.484165999716157,1.9001518911173585,-12.176245516214456],
[3.2007844364901237,-17.716932821701494,7.345229383623769],
[-3.200784461050925,17.716932836348224,-7.345229391698931],
[-0.00016481900627546915,0.00016479080290504993,8.224751453669598e-09],
[4.484165946101049,1.9001519446614326,-12.17624552182634],
[-6.703981402213167,-1.5369269819545186,-11.714006194440334],
[-10.33743138366749,-11.37031920550379,-0.7030138423481844],
[-7.196366765387595,12.257002000588157,-8.116857726969014],
[7.196366794963169,-12.257002025729781,8.116857721372378],
[3.200784453698674,-17.71693282869606,7.345229382819327],
[-10.33743137929157,-11.370319211272566,-0.7030138358878231],
[-4.296454954540611,-29.45710741701444,11.264138632189292],
[-9.293369185418122e-09,-8.051892055852886e-09,4.986142080563136e-09],
[10.337431404252055,11.370319216170635,0.703013839440982],
[-3.200784485714604,17.71693284030575,-7.34522939061184],
[-7.196366750059913,12.25700200128661,-8.116857712932985],
[-1.866634108489412e-08,-1.100509670408434e-08,2.541954461417902e-08],
[4.296454948401395,29.45710744509779,-11.264138651062074],
[-1.7676710338916541,-6.473237329183671,-11.714006199757302],
[-10.337431417117564,-11.370319211360375,-0.7030138397539928],
[-7.196366808994839,12.257002032912954,-8.116857720574531],
[0.00014028011747679845,-0.00014029892794089377,-1.4166173091390236e-08],
[4.484165975049539,1.9001519254467185,-12.176245516485976],
[-10.337431404252031,-11.37031921617064,-0.7030138394409833],
[-4.296454948401392,-29.45710744509778,11.264138651062073],
[1.8666334217207432e-08,1.100508595249323e-08,-2.5419536305671856e-08],
[7.196366750059897,-12.25700200128659,8.116857712932978],
[3.2007844857146046,-17.716932840305745,7.34522939061184],
[-7.196366794963172,12.257002025729781,-8.11685772137238],
[9.293368623665041e-09,8.051872898403206e-09,-4.986132146345622e-09],
[4.296454954540608,29.457107417014434,-11.264138632189292],
[10.337431379291584,11.370319211272548,0.7030138358878144],
[-3.2007844536986703,17.71693282869605,-7.345229382819337],
[0.00016481896832706448,-0.00016479076495392225,-8.224752229704712e-09],
[7.196366765387599,-12.25700200058816,8.116857726969013],
[10.337431383667475,11.370319205503788,0.7030138423481823],
[6.70398172769147,1.536926656476209,11.714006194440328],
[-4.484165946100985,-1.9001519446614905,12.17624552182633],
[4.484165930200145,1.900151995853627,-12.176245517355158],
[3.2007844610509157,-17.71693283634823,7.3452293916989335],
[-3.2007844364901255,17.7169328217015,-7.34522938362377],
[-4.484165999716144,-1.900151891117391,12.176245516214442],
[1.2878927789215965e-09,-1.2680519077687321e-08,6.78190635325721e-09],
[-2.7779442042858844,-19.841327267307843,-27.27953479322641],
[-13.70213024041079,-20.89008347249912,-18.43059010112468],
[-10.33776586148866,-11.37009375959428,-0.7015215392686284],
[-4.484041771240137,-1.9007316107073713,12.175579194318544],
[-0.0009878192481329845,0.0009878348217454704,1.2935988500573141e-09],
[-13.702130260524624,-20.890083487438663,-18.430590113612585],
[-16.600100186311515,-30.336201496735207,-17.14371325214378],
[-17.594197406470247,-8.969780220183717,-4.529829311784072],
[-1.3433562230541979e-08,-8.062859116954098e-09,-2.2432131371409777e-09],
[4.484041725669742,1.9007316508812087,-12.175579202433736],
[-10.337765846144006,-11.370093769273206,-0.7015215498107483],
[-17.594197401056892,-8.969780227959713,-4.529829299395216],
[3.0533685348849627e-09,-6.311088564109115e-10,5.260385534532861e-10],
[17.59419741188175,8.969780218179212,4.529829307496053],
[10.337765843779847,11.370093776177534,0.701521559004015],
[-4.484041761305542,-1.9007316197720157,12.17557919472875],
[1.3488510639001709e-08,2.4462435254950907e-09,-1.1307905395123256e-08],
[17.594197377238935,8.969780227425526,4.5298293198135795],
[16.600100188660488,30.33620151974958,17.14371323546527],
[13.702130250613424,20.89008348343349,18.430590090625106],
[-0.0008457961427178645,0.0008458066082531574,-6.586002598821478e-09],
[4.484041811347792,1.9007315791682051,-12.175579203978822],
[10.337765869369225,11.370093757181973,0.7015215566792257],
[13.702130270581762,20.890083482979954,18.430590099053227],
[4.112634553128828,18.50663686259643,27.279534816118552],
])

########################################################################


vy = np.array([[-6.379616610056577,-16.258472615952478,-27.283651533297043],
[-0.5204131033805384,-7.7236238920250795,-11.710093454796203],
[0.5204129181074926,7.723624077298124,11.710093454796196],
[6.379614867059758,16.25847435894929,27.28365153329703],
[0.9092553551175483,21.710016053486918,27.27953479393993],
[-0.0012390424038470171,0.001239081953703455,-5.8842813486118485e-08],
[4.484041837411212,1.9007315209592823,-12.175579178749116],
[10.337765826687923,11.370093780572862,0.7015215448169724],
[13.702130244103472,20.890083493588644,18.430590105153822],
[4.801091461739484,3.439816917545699,11.714006200589925],
[-4.484165954160771,-1.9001519231387745,12.17624553443563],
[-6.579753574510507e-05,6.577768241332903e-05,1.48059587643633e-08],
[7.196366780433138,-12.257002014667357,8.116857718566143],
[10.337431403600943,11.370319192454964,0.7030138359018269],
[-4.801086943895786,-3.4398214353893892,-11.714006200589921],
[-10.337431403600945,-11.370319192454959,-0.7030138359018332],
[-7.196366780433146,12.25700201466735,-8.116857718566145],
[6.579756848159128e-05,-6.577771515191188e-05,-1.4805957709282417e-08],
[4.484165954160833,1.9001519231387172,-12.176245534435623],
[-0.9092552629473203,-21.71001614565715,-27.279534793939913],
[-13.702130244103481,-20.890083493588648,-18.430590105153822],
[-10.337765826687926,-11.370093780572864,-0.7015215448169676],
[-4.484041837411231,-1.900731520959278,12.175579178749121],
[0.0012390422092959635,-0.001239081759150949,5.884280922206276e-08],
[-19.993259732521835,-2.6448295304204605,-27.283651533686108],
[-27.18997729008829,-27.19195289165892,-41.65667168051646],
[-16.600224393654763,-30.33562183214977,-17.14304689775375],
[-4.296120484224406,-29.45733284559466,11.262646374902081],
[3.073157662352626e-08,-1.0050755126590473e-08,1.2734689376041797e-08],
[0.0008457584485072283,-0.0008458033046731006,2.4106273178457304e-08],
[-20.53056103811702,-2.088710391610173,-27.27953479106746],
[-13.70213024310271,-20.89008349350795,-18.430590084875867],
[-10.337765848831083,-11.370093754070107,-0.7015215588524858],
[-4.484041746921506,-1.9007316336307991,12.175579198377013],
[-4.484165996580244,-1.9001518909239128,12.176245512485961],
[9.996836158768382e-09,5.940797673809237e-09,-4.855814630638317e-09],
[4.484165926794693,1.9001519579006472,-12.176245528202296],
[3.200784456922945,-17.716932833775587,7.345229397340901],
[-3.20078444562486,17.716932838912616,-7.3452293966957205],
[-10.337431395269006,-11.370319211184874,-0.7030138283807942],
[-4.2964549376061205,-29.457107429765337,11.264138650685851],
[-1.7610489576221857e-08,3.3935395013832825e-08,-2.538187719057105e-08],
[7.196366751924978,-12.257002017515934,8.116857731343597],
[3.200784453346501,-17.716932839973886,7.345229399663984],
[-13.702130248362486,-20.89008349015799,-18.430590116843604],
[-16.60010020068063,-30.3362015215443,-17.143713243934602],
[-17.594197399258274,-8.969780216686024,-4.529829305622371],
[3.3032530112095785e-09,-4.58997500138597e-09,-4.4274736714190124e-09],
[4.4840417317616765,1.900731631436945,-12.17557918663911],
[-5.609038782085956,-2.6349982496620963,-11.71009344701782],
[-16.60022440312987,-30.3356217853604,-17.14304691058316],
[-10.030592294397632,-10.030311708162,-20.06046245104993],
[2.869482568513862e-09,-1.091462324738462e-08,9.123955113401299e-09],
[4.296120493957146,29.45733284896252,-11.262646368513849],
[4.484041854172659,1.9007315469589026,-12.175579194440912],
[-13.702130280371769,-20.890083470251266,-18.430590111975413],
[-16.600100178675827,-30.336201512195988,-17.14371323567508],
[-17.594197396427464,-8.969780218568653,-4.529829306523989],
[4.202522251856906e-09,1.9383710925870175e-08,-1.2997724091627436e-09],
[-0.00016482762687819967,0.00016481309942783357,9.679773078380874e-09],
[4.484166013054184,1.9001518865223699,-12.176245523801818],
[-1.8399053844656423,-6.401003002780029,-11.71400618968257],
[-10.337431376794612,-11.370319216571387,-0.703013832885725],
[-7.196366775479797,12.257002016740628,-8.116857725475322],
[-7.196366767959067,12.257002015803533,-8.116857721753409],
[-2.3681274992335077e-08,2.5593606799020758e-08,8.179224436465708e-09],
[4.296454956954879,29.457107409270314,-11.264138632537811],
[10.33743140694256,11.370319198422594,0.703013833138237],
[-3.2007844275858277,17.716932818945427,-7.345229382250154],
[-10.337765836685358,-11.370093759261572,-0.7015215470861806],
[-17.594197397090973,-8.969780224459292,-4.529829289108983],
[2.161742442924811e-08,1.0066170800669222e-09,1.147411823016357e-08],
[17.594197379096,8.969780224096407,4.52982930086742],
[10.33776583230395,11.3700937882877,0.7015215531132925],
[5.609039098433981,2.6349979333140614,11.710093447017812],
[-4.296120493957144,-29.457332848962526,11.262646368513858],
[-2.869499383190878e-09,1.0914589406240881e-08,-9.123972992155152e-09],
[10.03059229440047,10.030311708159156,20.060462451049922],
[16.60022440312985,30.335621785360402,17.143046910583124],
[10.33776583668538,11.370093759261563,0.7015215470861837],
[-10.337765832303957,-11.370093788287706,-0.7015215531132931],
[-17.594197379096038,-8.969780224096416,-4.5298293008674],
[-2.1617426817817114e-08,-1.0066120039064952e-09,-1.1474134757971726e-08],
[17.594197397090973,8.969780224459289,4.52982928910897],
[7.196366767959069,-12.25700201580353,8.116857721753412],
[3.200784427585826,-17.716932818945438,7.345229382250141],
[-10.337431406942567,-11.370319198422612,-0.703013833138231],
[-4.296454956954881,-29.457107409270314,11.264138632537808],
[2.3681292567952203e-08,-2.559369476617341e-08,-8.179159631153084e-09],
[0.00016482758892718576,-0.0001648130614750915,-9.679772905484704e-09],
[7.196366775479804,-12.257002016740635,8.11685772547532],
[10.337431376794619,11.370319216571373,0.7030138328857232],
[1.8399036355483778,6.401004751697282,11.714006189682571],
[-4.484166013054257,-1.9001518865222926,12.176245523801796],
[-4.484041854172677,-1.9007315469588892,12.175579194440887],
[-4.202544376164345e-09,-1.9383673120222796e-08,1.299749659647529e-09],
[17.594197396427457,8.969780218568642,4.529829306523988],
[16.60010017867583,30.336201512196002,17.143713235675065],
[13.702130280371769,20.890083470251263,18.43059011197539],
[19.993257545820732,2.6448317171215874,27.283651533686115],
[-3.0731570355920315e-08,1.005071979931739e-08,-1.2734652415198811e-08],
[4.296120484224413,29.45733284559467,-11.262646374902072],
[16.600224393654766,30.335621832149783,17.14304689775371],
[27.189977290662558,27.191952891084636,41.65667168051647],
[13.702130248362495,20.890083490157995,18.430590116843618],
[-4.484041731761679,-1.9007316314369336,12.17557918663911],
[-3.303241085759904e-09,4.589964216121704e-09,4.427471244352982e-09],
[17.594197399258274,8.96978021668602,4.529829305622367],
[16.600100200680636,30.336201521544304,17.143713243934613],
[10.337431395268991,11.370319211184873,0.7030138283807906],
[-3.2007844533464906,17.71693283997388,-7.345229399663978],
[-7.196366751924988,12.257002017515948,-8.116857731343597],
[1.761046500705045e-08,-3.393540334476425e-08,2.5381893456368598e-08],
[4.296454937606124,29.457107429765326,-11.26413865068583],
[4.484165996580195,1.900151890923963,-12.176245512485954],
[3.200784445624853,-17.71693283891262,7.345229396695731],
[-3.200784456922938,17.716932833775584,-7.345229397340904],
[-4.484165926794694,-1.9001519579006512,12.17624552820228],
[-9.996839623140868e-09,-5.940776986758796e-09,4.855799985391858e-09],
[-0.0008457578838679676,0.0008458027400355326,-2.4106271282032313e-08],
[4.484041746921477,1.9007316336308313,-12.175579198377024],
[10.337765848831058,11.37009375407011,0.7015215588524835],
[13.702130243102701,20.89008349350794,18.430590084875863],
[20.53055885441516,2.088712575312026,27.27953479106745],
])

########################################################################

vz = np.array([[18.54249905298807,4.076772436021242,27.279534812362886],
[4.641713313336743,3.5991950989081216,11.714006195446993],
[-4.641713577352671,-3.5991948348921903,-11.714006195446986],
[-18.542499849924248,-4.076771639085054,-27.279534812362872],
[-16.29282220156602,-6.345267097104516,-27.283651551903667],
[-0.0012390652159430114,0.0012390543286334415,-1.3479480426127724e-08],
[-4.484165943102525,-1.9001519822578352,12.176245528140102],
[-10.337431422773081,-11.370319196691847,-0.7030138398719686],
[-13.702130265917361,-20.8900834904781,-18.430590119894482],
[-1.7340051901202407,-6.510031851458948,-11.710093453741514],
[4.484041810453526,1.9007315886774805,-12.175579177042335],
[-6.579767719891316e-05,6.5784661706718e-05,2.1803188862354156e-08],
[-7.196366773689233,12.257002011690881,-8.116857726740733],
[-10.337765840407174,-11.370093778193244,-0.7015215524927509],
[1.7340053167384881,6.510031724840698,11.710093453741509],
[10.33776584040717,11.37009377819324,0.7015215524927578],
[7.1963667736892285,-12.257002011690872,8.116857726740735],
[6.579770993812542e-05,-6.578469444533948e-05,-2.180318835803281e-08],
[-4.48404181045348,-1.9007315886775296,12.17557917704233],
[16.292823852137083,6.345265446533453,27.28365155190366],
[13.702130265917345,20.890083490478105,18.430590119894486],
[10.337431422773083,11.370319196691838,0.7030138398719611],
[4.484165943102517,1.9001519822578585,-12.17624552814011],
[0.0012390650213967558,-0.001239054134086882,1.3479480362007302e-08],
[-11.17651965214725,-11.461569638071627,-27.283651547406166],
[0.0009878208270682628,-0.0009878345051863404,-2.1091885706335164e-08],
[-4.48416600429818,-1.9001519098550457,12.17624552632155],
[-10.3374313726655,-11.370319220989556,-0.703013833275476],
[-13.702130262079667,-20.890083479276868,-18.430590107803997],
[-27.190119276399365,-27.191810925159604,-41.65667163287726],
[-9.285705524019498,-13.333565904136082,-27.279534800146813],
[9.477147509280497e-09,4.242665327889375e-08,-1.650195631537356e-08],
[-4.296454955497819,-29.457107393939207,11.264138659883988],
[-16.600100176719902,-30.33620148509397,-17.14371323226929],
[-16.600224379257774,-30.335621817717254,-17.143046905291826],
[-13.70213024754238,-20.890083500514315,-18.43059010464393],
[4.484166037459822,1.900151868941723,-12.176245523865822],
[8.011586750217978e-09,2.7462040310451228e-08,-2.6078291405024838e-08],
[-17.594197382599262,-8.969780226652992,-4.529829311230405],
[-4.296120483766721,-29.457332848269775,11.26264637018368],
[-10.33776585696097,-11.370093791424253,-0.7015215631554896],
[3.2007844433626533,-17.716932829166637,7.345229377104036],
[7.19636675799242,-12.257002013934462,8.116857739233147],
[-9.660850949670573e-09,-2.1295478131522508e-08,2.1095524667569168e-08],
[9.95832582226906e-09,-2.77635594170051e-08,2.486584834209177e-08],
[-4.484041824359679,-1.9007315740315942,12.175579192009],
[-3.200784442787074,17.716932835542313,-7.345229404459732],
[3.2007844531426026,-17.71693284201343,7.345229401788377],
[4.484041805637918,1.900731579394877,-12.175579182795765],
[-4.98778210753403,-3.256254919193227,-11.71009344416865],
[4.48404180866983,1.9007315875379562,-12.17557918836404],
[-0.00014028112789969118,0.00014029207853296944,1.576629754755533e-08],
[-7.196366758021016,12.257001995657328,-8.1168577115147],
[-10.337765836906383,-11.370093769024415,-0.7015215457670505],
[-16.600224357345056,-30.3356218182426,-17.143046907303795],
[-13.702130262030439,-20.890083496285616,-18.430590110393343],
[4.484165962563555,1.9001519278377754,-12.176245532457346],
[-2.956320560032847e-08,6.001352130143664e-09,7.652296700373778e-09],
[-17.59419739093839,-8.969780222295665,-4.5298293073108535],
[-10.030616817347534,-10.030287184949398,-20.06046247342363],
[-16.600100182591326,-30.33620151967219,-17.14371322673662],
[-3.8174758535375455,-4.423432553929187,-11.714006194347537],
[4.296454953801843,29.457107411621966,-11.264138642542031],
[-1.1208510279622898e-08,4.490733645000989e-09,1.7485778148805955e-09],
[1.618502236957442e-08,2.8642687966944174e-10,2.3513116874790187e-09],
[-17.594197366133912,-8.969780212700648,-4.529829311485993],
[-10.33743138247942,-11.370319213774643,-0.7030138286020028],
[10.337431413432814,11.37031919015295,0.7030138305636046],
[17.59419737774059,8.969780213462716,4.529829309922788],
[4.296120505444078,29.457332863690795,-11.262646363479579],
[9.330298020141839e-09,1.6387742960207542e-08,1.4589861781300283e-08],
[-7.196366766933688,12.257002010721363,-8.1168577098149],
[-3.200784451019292,17.71693284102074,-7.345229375550372],
[10.337765843157264,11.370093776804334,0.7015215567194872],
[4.987781106668305,3.256255920058949,11.710093444168644],
[10.337765836906398,11.370093769024404,0.7015215457670582],
[7.196366758020998,-12.257001995657316,8.116857711514703],
[0.00014028113074546097,-0.00014029208137457215,-1.5766303245561705e-08],
[-4.484041808669763,-1.9007315875380149,12.175579188364038],
[-4.2961205054440725,-29.457332863690784,11.262646363479577],
[-10.337765843157268,-11.370093776804346,-0.7015215567194873],
[3.2007844510193055,-17.71693284102074,7.34522937555034],
[7.196366766933707,-12.257002010721378,8.116857709814898],
[-9.330293241632759e-09,-1.638774950919565e-08,-1.4589862733002187e-08],
[-1.618503770095905e-08,-2.864610610157109e-10,-2.3513297904408266e-09],
[-17.594197377740596,-8.96978021346273,-4.529829309922784],
[-10.337431413432808,-11.370319190152962,-0.7030138305636003],
[10.337431382479407,11.370319213774652,0.7030138286019996],
[17.594197366133887,8.969780212700632,4.529829311485994],
[10.030616817309575,10.030287184987348,20.06046247342361],
[1.1208505681147714e-08,-4.490741964028903e-09,-1.7485841492352927e-09],
[-4.296454953801844,-29.45710741162197,11.264138642542036],
[3.8174772769764758,4.42343113049025,11.714006194347533],
[16.600100182591337,30.336201519672173,17.143713226736608],
[16.60022435734505,30.33562181824261,17.143046907303756],
[17.594197390938373,8.969780222295666,4.529829307310855],
[2.9563202711665194e-08,-6.001367686349644e-09,-7.652286715561858e-09],
[-4.484165962563577,-1.9001519278377537,12.176245532457337],
[13.702130262030437,20.89008349628561,18.430590110393325],
[11.176523286704608,11.461566003514289,27.28365154740618],
[13.702130262079663,20.890083479276857,18.430590107804004],
[10.3374313726655,11.37031922098956,0.7030138332754715],
[4.4841660042981735,1.9001519098550719,-12.176245526321544],
[-0.0009878202527995273,0.0009878339309044924,2.1091897567244602e-08],
[-9.958321004971442e-09,2.7763518401175445e-08,-2.4865808971288496e-08],
[-4.484041805637911,-1.9007315793948791,12.175579182795763],
[-3.2007844531426013,17.71693284201342,-7.345229401788378],
[3.2007844427870755,-17.716932835542313,7.34522940445974],
[4.4840418243596565,1.9007315740316215,-12.175579192008996],
[4.296120483766725,29.457332848269765,-11.262646370183676],
[9.660857717539896e-09,2.1295469922156746e-08,-2.1095526181417318e-08],
[-7.196366757992409,12.257002013934462,-8.116857739233142],
[-3.200784443362653,17.71693282916663,-7.345229377104044],
[10.337765856960969,11.37009379142425,0.7015215631554841],
[16.600224379257746,30.335621817717236,17.143046905291783],
[17.594197382599262,8.96978022665299,4.529829311230416],
[-8.01159264751666e-09,-2.7462056787063507e-08,2.607829864803764e-08],
[-4.484166037459814,-1.900151868941722,12.176245523865806],
[13.70213024754238,20.890083500514308,18.43059010464391],
[27.190119276964023,27.19181092459492,41.6566716328773],
[16.600100176719902,30.336201485093973,17.143713232269292],
[4.296454955497817,29.457107393939214,-11.26413865988398],
[-9.477148984006052e-09,-4.242662578309197e-08,1.6501938805130182e-08],
[9.285713695528717,13.333557732626863,27.27953480014682],
])

########################################################################

@pytest.yield_fixture(scope="session")
def phonons():
    print ("Preparing phonons object.")
    # Setup crystal and EMT calculator
    atoms = bulk('Al', 'fcc', a=4.05)
    N=5
    supercell = (N, N, N)
    with TemporaryDirectory() as td:
        finite_difference = FiniteDifference(atoms=atoms,
                                             supercell=supercell,
                                             calculator=EMT,
                                             is_reduced_second=True,
                                             folder=td)
        is_classic = False
        k = 5
        phonons_config = {'kpts': [k, k, k],
                          'is_classic': is_classic,
                          'temperature': 300,
                          'is_tf_backend':False,
                          'storage':'memory',
                          'third_bandwidth':.1,
                          'broadening_shape':'gauss'}
        phonons = Phonons(finite_difference=finite_difference, **phonons_config)
        return phonons


def test_velocity_with_finite_difference(phonons):
    calculated_velocity = phonons.velocity
    calculated_vx = calculated_velocity[1:,:,0]
    np.testing.assert_equal(np.round(calculated_vx - vx, 2), 0)

    calculated_vy = calculated_velocity[1:,:,1]
    np.testing.assert_equal(np.round(calculated_vy - vy, 2), 0)

    calculated_vz = calculated_velocity[1:,:,2]
    np.testing.assert_equal(np.round(calculated_vz - vz, 2), 0)

